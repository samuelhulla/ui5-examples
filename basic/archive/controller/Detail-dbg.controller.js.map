{"version":3,"file":"Detail-dbg.controller.js","names":["getRouter","___util_router","formatter","_interopRequireDefault","__formatter","Detail","Controller","extend","constructor","prototype","apply","arguments","FragmentCache","onInit","_onInit","router","getRoute","attachPatternMatched","oEvent","id","getParameter","model","getOwnerComponent","getModel","getMetaModel","loaded","then","attachRequestCompleted","getButton","setEnabled","toggle","getView","bindElement","expand","catch","error","MessageToast","show","message","onNavBack","_onNavBack","navTo","onEdit","_onEdit","onSave","_onSave","submitChanges","onCancel","_onCancel","resetChanges","getFragment","_getFragment","fragment","name","oFragment","Fragment","load","controller","_getButton","byId","_toggle","mode","oForm","removeAllItems","addItem","toggleButtons","isEditMode","toggleButton","flag","setVisible"],"sources":["Detail.controller.ts"],"sourcesContent":["import { getRouter } from \"../util/router\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport type ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport formatter from \"../model/formatter\";\nimport type Control from \"sap/ui/core/Control\";\nimport type Button from \"sap/m/Button\";\nimport type VBox from \"sap/m/VBox\";\n\ntype Fragments = \"Detail\" | \"Edit\";\n\n/**\n * @namespace project1.controller\n */\nexport default class Detail extends Controller {\n  private FragmentCache: Partial<Record<Fragments, Control>> = {};\n  public formatter = formatter;\n\n  /*eslint-disable @typescript-eslint/no-empty-function*/\n  public onInit(): void {\n    const router = getRouter(this);\n    router.getRoute(\"detail\")?.attachPatternMatched((oEvent) => {\n      const { id } = oEvent.getParameter(\"arguments\") as { id: number };\n      const model = this.getOwnerComponent()?.getModel() as ODataModel;\n      model\n        .getMetaModel()\n        .loaded()\n        .then(async () => {\n          model.attachRequestCompleted(() => this.getButton(\"edit\").setEnabled(true));\n          await this.toggle(\"Detail\");\n          this.getView()?.bindElement(`/Products(${id})`, {\n            expand: \"Supplier,Category\",\n          });\n        })\n        .catch((error) => {\n          MessageToast.show(`Failed to load model: ${error.message}`);\n        });\n    });\n  }\n\n  public onNavBack() {\n    const router = getRouter(this);\n    router.navTo(\"products\");\n  }\n\n  public onEdit() {\n    // ui5 cant pass async functions to event handlers, so we just pass this abstraction\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.toggle(\"Edit\");\n  }\n\n  public onSave() {\n    const model = this.getView()?.getModel() as ODataModel;\n    model.submitChanges();\n    this.toggle(\"Detail\")\n      .then(() => {\n        MessageToast.show(\"Product succesfully saved!\");\n      })\n      .catch((error) => {\n        MessageToast.show(`Failed to save product: ${error.message}`);\n      });\n  }\n\n  public onCancel() {\n    const model = this.getView()?.getModel() as ODataModel;\n    model\n      ?.resetChanges()\n      .then(async () => {\n        await this.toggle(\"Detail\");\n        MessageToast.show(\"Changes discarded\");\n      })\n      .catch((error) => {\n        MessageToast.show(`Failed to discard changes: ${error.message}`);\n      });\n  }\n\n  private async getFragment(fragment: Fragments): Promise<Control> {\n    const name = \"project1.view.fragments.\" + fragment;\n    if (this.FragmentCache[fragment]) {\n      return this.FragmentCache[fragment];\n    }\n    const oFragment = await Fragment.load({\n      name,\n      controller: this,\n    });\n    this.FragmentCache = {\n      ...this.FragmentCache,\n      [fragment]: oFragment,\n    };\n    return oFragment as Control;\n  }\n\n  private getButton(id: \"edit\" | \"save\" | \"cancel\"): Button {\n    return this.byId(id) as Button;\n  }\n\n  private async toggle(mode: Fragments) {\n    const oForm = this.byId(\"detail\") as VBox;\n    const oFragment = await this.getFragment(mode);\n    oForm.removeAllItems();\n    oForm.addItem(oFragment);\n\n    const toggleButtons = (isEditMode: boolean) => {\n      const toggleButton = (id: Parameters<typeof this.getButton>[0], flag: boolean) => {\n        this.getButton(id).setVisible(flag);\n        this.getButton(id).setEnabled(flag);\n      };\n\n      toggleButton(\"edit\", !isEditMode);\n      toggleButton(\"save\", isEditMode);\n      toggleButton(\"cancel\", isEditMode);\n    };\n\n    toggleButtons(mode === \"Edit\");\n  }\n}\n"],"mappings":"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","ignoreList":[]}