{"version":3,"file":"Detail.controller.js","names":["getRouter","___util_router","formatter","_interopRequireDefault","__formatter","Detail","Controller","extend","constructor","prototype","apply","this","arguments","FragmentCache","onInit","_onInit","router","getRoute","attachPatternMatched","oEvent","id","getParameter","model","getOwnerComponent","getModel","getMetaModel","loaded","then","async","attachRequestCompleted","getButton","setEnabled","toggle","getView","bindElement","expand","catch","error","MessageToast","show","message","onNavBack","_onNavBack","navTo","onEdit","_onEdit","onSave","_onSave","submitChanges","onCancel","_onCancel","resetChanges","getFragment","_getFragment","fragment","name","oFragment","Fragment","load","controller","_getButton","byId","_toggle","mode","oForm","removeAllItems","addItem","toggleButtons","isEditMode","toggleButton","flag","setVisible"],"sources":["Detail.controller.ts"],"sourcesContent":["import { getRouter } from \"../util/router\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport type ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport formatter from \"../model/formatter\";\nimport type Control from \"sap/ui/core/Control\";\nimport type Button from \"sap/m/Button\";\nimport type VBox from \"sap/m/VBox\";\n\ntype Fragments = \"Detail\" | \"Edit\";\n\n/**\n * @namespace project1.controller\n */\nexport default class Detail extends Controller {\n  private FragmentCache: Partial<Record<Fragments, Control>> = {};\n  public formatter = formatter;\n\n  /*eslint-disable @typescript-eslint/no-empty-function*/\n  public onInit(): void {\n    const router = getRouter(this);\n    router.getRoute(\"detail\")?.attachPatternMatched((oEvent) => {\n      const { id } = oEvent.getParameter(\"arguments\") as { id: number };\n      const model = this.getOwnerComponent()?.getModel() as ODataModel;\n      model\n        .getMetaModel()\n        .loaded()\n        .then(async () => {\n          model.attachRequestCompleted(() => this.getButton(\"edit\").setEnabled(true));\n          await this.toggle(\"Detail\");\n          this.getView()?.bindElement(`/Products(${id})`, {\n            expand: \"Supplier,Category\",\n          });\n        })\n        .catch((error) => {\n          MessageToast.show(`Failed to load model: ${error.message}`);\n        });\n    });\n  }\n\n  public onNavBack() {\n    const router = getRouter(this);\n    router.navTo(\"products\");\n  }\n\n  public onEdit() {\n    // ui5 cant pass async functions to event handlers, so we just pass this abstraction\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.toggle(\"Edit\");\n  }\n\n  public onSave() {\n    const model = this.getView()?.getModel() as ODataModel;\n    model.submitChanges();\n    this.toggle(\"Detail\")\n      .then(() => {\n        MessageToast.show(\"Product succesfully saved!\");\n      })\n      .catch((error) => {\n        MessageToast.show(`Failed to save product: ${error.message}`);\n      });\n  }\n\n  public onCancel() {\n    const model = this.getView()?.getModel() as ODataModel;\n    model\n      ?.resetChanges()\n      .then(async () => {\n        await this.toggle(\"Detail\");\n        MessageToast.show(\"Changes discarded\");\n      })\n      .catch((error) => {\n        MessageToast.show(`Failed to discard changes: ${error.message}`);\n      });\n  }\n\n  private async getFragment(fragment: Fragments): Promise<Control> {\n    const name = \"project1.view.fragments.\" + fragment;\n    if (this.FragmentCache[fragment]) {\n      return this.FragmentCache[fragment];\n    }\n    const oFragment = await Fragment.load({\n      name,\n      controller: this,\n    });\n    this.FragmentCache = {\n      ...this.FragmentCache,\n      [fragment]: oFragment,\n    };\n    return oFragment as Control;\n  }\n\n  private getButton(id: \"edit\" | \"save\" | \"cancel\"): Button {\n    return this.byId(id) as Button;\n  }\n\n  private async toggle(mode: Fragments) {\n    const oForm = this.byId(\"detail\") as VBox;\n    const oFragment = await this.getFragment(mode);\n    oForm.removeAllItems();\n    oForm.addItem(oFragment);\n\n    const toggleButtons = (isEditMode: boolean) => {\n      const toggleButton = (id: Parameters<typeof this.getButton>[0], flag: boolean) => {\n        this.getButton(id).setVisible(flag);\n        this.getButton(id).setEnabled(flag);\n      };\n\n      toggleButton(\"edit\", !isEditMode);\n      toggleButton(\"save\", isEditMode);\n      toggleButton(\"cancel\", isEditMode);\n    };\n\n    toggleButtons(mode === \"Edit\");\n  }\n}\n"],"mappings":"oQAASA,EAASC,EAAA,mBAKXC,EAASC,EAAAC,GAOhB,MAGqBC,EAAeC,EAAUC,OAAA,8BAAAC,YAAA,SAAAA,IAAAF,EAAAG,UAAAD,YAAAE,MAAAC,KAAAC,WAAAD,KACpCE,cAAqD,CAAC,EAACF,KACxDT,UAAYA,CAAS,EAGrBY,OAAM,SAAAC,IACX,MAAMC,EAAShB,EAAUW,MACzBK,EAAOC,SAAS,WAAWC,qBAAsBC,IAC/C,MAAMC,GAAEA,GAAOD,EAAOE,aAAa,aACnC,MAAMC,EAAQX,KAAKY,qBAAqBC,WACxCF,EACGG,eACAC,SACAC,KAAKC,UACJN,EAAMO,uBAAuB,IAAMlB,KAAKmB,UAAU,QAAQC,WAAW,aAC/DpB,KAAKqB,OAAO,UAClBrB,KAAKsB,WAAWC,YAAY,aAAad,KAAO,CAC9Ce,OAAQ,qBACR,GAEHC,MAAOC,IACNC,EAAaC,KAAK,yBAAyBF,EAAMG,UAAU,EAC3D,EAER,EAEOC,UAAS,SAAAC,IACd,MAAM1B,EAAShB,EAAUW,MACzBK,EAAO2B,MAAM,WACf,EAEOC,OAAM,SAAAC,IAGXlC,KAAKqB,OAAO,OACd,EAEOc,OAAM,SAAAC,IACX,MAAMzB,EAAQX,KAAKsB,WAAWT,WAC9BF,EAAM0B,gBACNrC,KAAKqB,OAAO,UACTL,KAAK,KACJW,EAAaC,KAAK,6BAA6B,GAEhDH,MAAOC,IACNC,EAAaC,KAAK,2BAA2BF,EAAMG,UAAU,EAEnE,EAEOS,SAAQ,SAAAC,IACb,MAAM5B,EAAQX,KAAKsB,WAAWT,WAC9BF,GACI6B,eACDxB,KAAKC,gBACEjB,KAAKqB,OAAO,UAClBM,EAAaC,KAAK,oBAAoB,GAEvCH,MAAOC,IACNC,EAAaC,KAAK,8BAA8BF,EAAMG,UAAU,EAEtE,EAEcY,YAAWxB,eAAAyB,EAACC,GACxB,MAAMC,EAAO,2BAA6BD,EAC1C,GAAI3C,KAAKE,cAAcyC,GAAW,CAChC,OAAO3C,KAAKE,cAAcyC,EAC5B,CACA,MAAME,QAAkBC,EAASC,KAAK,CACpCH,OACAI,WAAYhD,OAEdA,KAAKE,cAAgB,IAChBF,KAAKE,cACRyC,CAACA,GAAWE,GAEd,OAAOA,CACT,EAEQ1B,UAAS,SAAA8B,EAACxC,GAChB,OAAOT,KAAKkD,KAAKzC,EACnB,EAEcY,OAAMJ,eAAAkC,EAACC,GACnB,MAAMC,EAAQrD,KAAKkD,KAAK,UACxB,MAAML,QAAkB7C,KAAKyC,YAAYW,GACzCC,EAAMC,iBACND,EAAME,QAAQV,GAEd,MAAMW,EAAiBC,IACrB,MAAMC,EAAeA,CAACjD,EAA0CkD,KAC9D3D,KAAKmB,UAAUV,GAAImD,WAAWD,GAC9B3D,KAAKmB,UAAUV,GAAIW,WAAWuC,EAAK,EAGrCD,EAAa,QAASD,GACtBC,EAAa,OAAQD,GACrBC,EAAa,SAAUD,EAAW,EAGpCD,EAAcJ,IAAS,OACzB,IAAC,OApGkB1D,CAAM","ignoreList":[]}